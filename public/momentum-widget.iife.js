var MomentumWidget=(()=>{(async function(){let y="http://localhost:3000",d=new URLSearchParams(window.location.search).get("bucket")||"low",b=`${y}/momentum/${d}`;function o(e,n=2){return isNaN(e)?"\u2014":Number(e).toLocaleString(void 0,{maximumFractionDigits:n})}function g(e){return isNaN(e)?"\u2014":e>=1e6?(e/1e6).toFixed(1)+"M":Number(e).toLocaleString()}let s={darkRed:"#c82333",lightRed:"#f8d7da",gray:"#e0e0e0",lightGreen:"#d4edda",mediumGreen:"#a3d3a1",brightGreen:"#7cc47c",darkGreen:"#3a6f3a",blue:"#007bff",yellow:"#ffeeba"};function m(e,n){switch(n){case"rvol":return e<1?"gray":e<2?"lightGreen":e<3?"mediumGreen":e<5?"brightGreen":"darkGreen";case"change":return e<=-50?"darkRed":e<=-10||e<0?"lightRed":e===0?"gray":e<5?"lightGreen":e<15?"mediumGreen":e<30?"brightGreen":"darkGreen";case"gap":return e<=-5?"darkRed":e<-1?"lightRed":Math.abs(e)<1?"gray":e<3?"lightGreen":e<7?"brightGreen":"blue";case"volume":return e<5e5?"gray":e<2e6?"lightGreen":e<5e6?"mediumGreen":e<1e7?"brightGreen":e<5e7?"darkGreen":"blue";case"float_pct":return e<5?"gray":e<10?"lightBlue":e<20?"mediumBlue":e<50?"brightBlue":"darkBlue";case"atr":return e<.5?"gray":e<1?"yellow":e<2?"brightGreen":"darkRed";case"dev":return e<=-2?"darkRed":e<=-.5?"lightRed":Math.abs(e)<=.5?"gray":e<=2?"lightGreen":"brightGreen"}return null}function w(e){document.getElementById("mkt-status").textContent=`(${e.market_status})`,document.getElementById("mkt-note").textContent=e.note,document.getElementById("mkt-ts").textContent="Updated: "+new Date(e.timestamp*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}async function u(e,n,p){let i=document.createElement("div");if(i.appendChild(Object.assign(document.createElement("h2"),{textContent:n})),!e.length){let t=document.createElement("div");return t.className="no-data",t.textContent=`No ${n}`,i.appendChild(t),i}let l=document.createElement("table"),G=["Strat","Time","Type","Symbol","Price","RVOL","Chg%","Gap%","Vol","Float","ATR","VWAP","Entry"],C=l.createTHead().insertRow();G.forEach(t=>C.appendChild(Object.assign(document.createElement("th"),{textContent:t})));let E=l.createTBody();return e.forEach(t=>{let R=E.insertRow(),L=(t.price-t.vwap)/t.vwap*100,B=t.gap_pct,M=t.float?t.volume/t.float*100:0,N=[p,t.time,t.type,t.ticker,o(t.price),o(t.rvol,1),o(t.change_from_open),o(B,1),g(t.volume),g(t.float),o(t.atr),o(t.vwap),t.entry],T={4:"dev",5:"rvol",6:"change",7:"gap",8:"volume",9:"float_pct",10:"atr",11:"dev",12:"entry"};N.forEach((_,a)=>{let r=R.insertCell();if(r.textContent=_,a<4){r.className=p==="LOW"?"green-bright":"green-dark";return}if(a===4||a===11){let c=m(L,"dev");r.style.background=s[c],r.style.color="#000";return}if(a===12){let c=t.entry,I=c.includes("Long")?"brightGreen":c.includes("Short")?"darkRed":c.includes("Reversion")?"yellow":"gray";r.style.background=s[I],r.style.color="#000";return}let f=T[a],x=f==="float_pct"?M:t[f],H=m(x,f);r.style.background=s[H]||null,r.style.color="#000"})}),i.appendChild(l),i}async function k(e){w(e);let n=document.getElementById("mkt-tables");n.innerHTML="",d==="raw"?(n.appendChild(await u(e.high_float,"High-Float Momentum","HIGH")),n.appendChild(await u(e.low_float,"Low-Float Momentum","LOW"))):d==="high"?n.appendChild(await u(e.high_float,"High-Float Momentum","HIGH")):n.appendChild(await u(e.low_float,"Low-Float Momentum","LOW"))}async function h(){try{let e=await fetch(b);if(!e.ok)throw new Error(e.statusText);let n=await e.json();await k(n)}catch(e){console.error(e),document.getElementById("mkt-tables").innerHTML='<div class="no-data">No data</div>'}}document.addEventListener("DOMContentLoaded",()=>{h(),setInterval(h,6e4)})})();})();
